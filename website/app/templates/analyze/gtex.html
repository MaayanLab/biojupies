{% extends 'base.html' %}
{% import 'macros.html' as macros %}

<!-- Title -->
{% block title %} BioJupies | Select Tools {% endblock %}

<!-- Content -->
{% block content %}

<style>
.dataTables_length, .dataTables_filter, .dataTables_info, .dataTables_paginate {
    font-size: 10pt;
}
.select-info {
    display: none;
}
.paginate_button {
    background-color: white;
    border: 1px solid #c9c9c9 !important;
    border-bottom: 2px solid #d5d5d5 !important;
    border-radius: .25rem !important;
}
.paginate_button:not(.disabled):hover {
    background: #007bff !important;
}
.dataTables_filter input {
    border: 1px solid #c9c9c9 !important;
    border-radius: .25rem !important;
}
.dataTables_info {
    max-width: 50%;
}
[role="row"] { cursor: pointer;; }
[role="row"].selected { background-color: #007bff !important; color: white !important;}
/* [role="row"].selected td::before { border-color: white !important; } */

.dataTables_wrapper select { outline: none !important; background-color: white !important; }

.col-6:first-child {
    /* border-right: 1px solid rgba(0,0,0,.1); */
}

</style>

<div class="px-6">

	<!-- Title -->
	<div class="row pt-4">
		<div class="col-12 very-large text-center light px-5">Which samples would you like to compare?</div>
	</div>

	<!-- Introduction -->
	<hr width="100%" class="my-4">
	<div class="row">
		<div class="light very-small my-1 col-lg-8 col-xl-9 text-justify">
			Using the tables below, you can select <b>two groups of samples</b> from the GTEx dataset. Gene expression in the two groups will be compared in the final Jupyter Notebook. To assign samples to a group, <b>filter the table using the provided menus</b> and <b>use the checkboxes</b>; then click Continue to proceed.
		</div>
		<div class="col-lg-4 col-xl-3 my-auto text-center pt-3 pt-lg-0">
			<button class="btn black border-custom bg-white nodecoration mr-2" onclick="goBack();"><i class="fa fa-angle-left mr-2"></i>Back</button>
			<button class="btn navigate white border-custom bg-blue nodecoration" form="" type="submit" formaction="{{ url_for('configure_analysis') }}" formmethod="post">
				Continue<i class="fa fa-angle-right ml-2"></i>
			</button>
		</div>
	</div>

	 <!-- Add Tools Form -->
	 <div class="row">
		<hr width="100%" class="mt-4 mb-2">
		<div class="col-12 px-3">

            <div class="row">
                {% for i in range(2) %}
                    <div class="col-6 mt-2 mb-4">
                        <div class="mt-0 mb-4 pb-3 px-3">

                            <!-- Title -->
                            <div class='mt-3 mb-0 gtex-table-header d-none'>
                                <div class="px-5">
                                    <span class='medium bold mb-2'>Group {{ loop.index }}</span>
                                    <span class='float-right very-small light mt-1'>
                                        <span id="nr-samples-{{ loop.index }}">0</span>
                                        <span> samples selected</span>
                                    </span>
                                </div>
                                <hr width="100%" class="mt-3 mb-4">
                            </div>
    
                            <!-- Loader -->
                            <div class="gtex-loader my-5">
                                <div class="small light text-center">Loading samples...</div>
                                <div class="loader"></div>
                            </div>

                            <!-- Table -->
                            <table class='gtex-table d-none tiny w-100 text-center'>
                                <thead class='very-small'>
                                    <tr>
                                        <th></th>
                                        <th>Age</th>
                                        <th>Gender</th>
                                        <th>Tissue</th>
                                    </tr>
                                    <tr>
                                        <th></th>
                                        <th>Age</th>
                                        <th>Gender</th>
                                        <th>Tissue</th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </tfoot>
                            </table>

                        </div>
                    </div>
                {% endfor %}
            </div>


		</div>
	</div>
</div>

{% endblock %}


{% block footer %}
<script type="text/javascript">

    // Data Table
    $(document).ready(function () {

        // Load GTEx metadata
        $.ajax({
            url: "{{ url_for('gtex_api') }}",
            dataType: "json",
            method: "POST",
            success: function(json) {

                // Loop through tables
                $('.gtex-table').each(function(index, elem) {

                    // Create table
                    var table = $(elem).DataTable({
                        data: json,
                        aaSorting: [],
                        // dom: 'Bfrtip',
                        pagingType: 'simple',
                        columns: [
                            {data: 'checkbox', orderable: false, className: 'select-checkbox'},
                            {data: 'Age', orderable: false},
                            {data: 'Gender', orderable: false},
                            {data: 'Tissue', orderable: false}
                        ],
                        select: {
                            style: 'multi'
                        },
                        // buttons: [
                        //     {
                        //         text: 'Select All',
                        //         action: function () {
                        //             table.rows({filter: 'applied'}).select();
                        //         }
                        //     },
                        //     {
                        //         text: 'Deselect All',
                        //         action: function () {
                        //             table.rows().deselect();
                        //         }
                        //     }
                        // ],
                        initComplete: function () {
                            this.api().columns().every(function () {
                                var column = this;
                                if (column.index() > 0)
                                {
                                    var select = $('<select><option value=""></option></select>')
                                        .appendTo($(column.header()).empty())
                                        .on('change', function () {
                                            var val = $.fn.dataTable.util.escapeRegex(
                                                $(this).val()
                                            );

                                            column
                                                .search(val ? '^' + val + '$' : '', true, false)
                                                .draw();
                                        });

                                    column.data().unique().sort().each(function (d, j) {
                                        select.append('<option value="' + d + '">' + d + '</option>')
                                    });
                                }
                            });
                        }
                    })

                })

                // Show table
                $('.gtex-table').removeClass('d-none');
                $('.gtex-table-header').removeClass('d-none');
                $('.gtex-loader').addClass('d-none');
            }
        })
    })
            // initComplete: function () {
            //     this.api().columns().every(function () {
            //         var column = this;
            //         var select = $('<select><option value=""></option></select>')
            //             .appendTo($(column.footer()).empty())
            //             .on('change', function () {
            //                 var val = $.fn.dataTable.util.escapeRegex(
            //                     $(this).val()
            //                 );

            //                 column
            //                     .search(val ? '^' + val + '$' : '', true, false)
            //                     .draw();
            //             });

            //         column.data().unique().sort().each(function (d, j) {
            //             select.append('<option value="' + d + '">' + d + '</option>')
            //         });
            //     });
            // }
        // });
    // });


</script>
{% endblock %}